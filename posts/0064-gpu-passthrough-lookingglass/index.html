<!doctype html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9 crossorigin=anonymous><link rel=stylesheet href=https://dmachard.github.io/css/gists.css><title>GPU Passthrough et Looking Glass: transformer un PC Linux en station de jeu hybride - My technical gists</title><link rel=icon type=image/x-icon href=/images/avatar.png><meta name=theme-color content="#1e2327"><meta name=description content="Setup Guide pour Ubuntu"><meta name=keywords content="blog,technical"><meta name=robots content="noodp"><link rel=canonical href=https://dmachard.github.io/posts/0064-gpu-passthrough-lookingglass/><meta name=twitter:card content="summary"><meta name=twitter:title content="GPU Passthrough et Looking Glass: transformer un PC Linux en station de jeu hybride - My technical gists"><meta name=twitter:description content="Setup Guide pour Ubuntu"><meta name=twitter:site content="https://dmachard.github.io/"><meta name=twitter:creator content><meta name=twitter:image content="https://dmachard.github.io/"><meta property="og:type" content="article"><meta property="og:title" content="GPU Passthrough et Looking Glass: transformer un PC Linux en station de jeu hybride - My technical gists"><meta property="og:description" content="Setup Guide pour Ubuntu"><meta property="og:url" content="https://dmachard.github.io/posts/0064-gpu-passthrough-lookingglass/"><meta property="og:site_name" content="GPU Passthrough et Looking Glass: transformer un PC Linux en station de jeu hybride"><meta property="og:image" content="https://dmachard.github.io/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2026-02-07 00:00:00 +0100 +0100"></head><body><main><div class=container-xl><div class="d-flex flex-sm-row flex-column"><div class="p-2 pt-0 col-sm-3"><div class="d-flex flex-column sticky-top"><div class="d-flex flex-sm-column"><div class="pt-3 pt-md-2 pb-2 order-sm-1 order-2"><p class="fs-4 fw-bold p-0 m-0">Denis Machard</p><p class="fs-5 text-dark-emphasis">My technical gists</p></div><div class="pt-2 pe-2 col-3 col-sm-12 order-sm-2 order-1"><a href=/images/profile.png><img width=250 class="img-thumbnail rounded-pill border bg-white" src=/images/profile.png></a></div></div><div class="mt-3 fs-6 text-dark-emphasis">Infrastructure background, developer mindset. I build things for pleasure.</div><div class=pt-3><ul class=list-unstyled></ul></div><div class="pt-3 pb-4"><a style="margin:0 10px 10px 0" href=https://github.com/dmachard><img alt=@github width=32 height=32 src=https://dmachard.github.io/images/github.png></a>
<a style="margin:0 10px 10px 0" href=https://fosstodon.org/@dmachard><img alt=@mastodon width=32 height=32 src=https://dmachard.github.io/images/mastodon.png></a>
<a style="margin:0 10px 10px 0" href=https://dmachard.github.io/index.xml><img alt=@rss width=32 height=32 src=https://dmachard.github.io/images/rss.png></a></div></div></div><div class="p-2 pt-0 col-sm-9"><ul class="nav nav-underline sticky-top d-flex pt-2 mb-md-4 bg-white border-bottom"><li class="nav-item px-md-1"><a class="nav-link text-dark-emphasis" href=https://dmachard.github.io/><svg height="16" viewBox="0 0 16 16" width="16"><path class="me-1" fill-rule="evenodd" d="m11.294.984 3.722 3.722a1.75 1.75.0 01-.504 2.826l-1.327.613a3.089 3.089.0 00-1.707 2.084l-.584 2.454c-.317 1.332-1.972 1.8-2.94.832L5.75 11.311 1.78 15.28A.749.749.0 11.72 14.22l3.969-3.97-2.204-2.204c-.968-.968-.5-2.623.832-2.94l2.454-.584a3.08 3.08.0 002.084-1.707l.613-1.327a1.75 1.75.0 012.826-.504zM6.283 9.723l2.732 2.731a.25.25.0 00.42-.119l.584-2.454a4.586 4.586.0 012.537-3.098l1.328-.613a.25.25.0 00.072-.404l-3.722-3.722a.25.25.0 00-.404.072l-.613 1.328A4.584 4.584.0 016.119 5.981l-2.454.584a.25.25.0 00-.119.42l2.731 2.732z"/></svg><span class=m-1>Pinned</span>
<span class="badge fw-normal bg-secondary bg-opacity-25 text-opacity-50 rounded-pill text-dark-emphasis">5</span></a></li><li class="nav-item px-md-1"><a class='nav-link text-dark active' href=https://dmachard.github.io//posts/><svg height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M0 1.75A.75.75.0 01.75 1h4.253c1.227.0 2.317.59 3 1.501A3.744 3.744.0 0111.006 1h4.245a.75.75.0 01.75.75v10.5a.75.75.0 01-.75.75h-4.507a2.25 2.25.0 00-1.591.659l-.622.621a.75.75.0 01-1.06.0l-.622-.621A2.25 2.25.0 005.258 13H.75A.75.75.0 010 12.25V1.75zm8.755 3a2.25 2.25.0 012.25-2.25H14.5v9h-3.757c-.71.0-1.4.201-1.992.572l.004-7.322zm-1.504 7.324.004-5.073-.002-2.253A2.25 2.25.0 005.003 2.5H1.5v9h3.757a3.75 3.75.0 011.994.574z"/></svg><span class=m-1>Gists</span>
<span class="badge fw-normal bg-secondary bg-opacity-25 text-opacity-50 rounded-pill text-dark-emphasis">58</span></a></li><li class="nav-item px-md-1"><a class='nav-link text-dark-emphasis' href=https://dmachard.github.io//tags/><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25.0 01.25-.25h5.025a.25.25.0 01.177.073l6.25 6.25a.25.25.0 010 .354l-5.025 5.025a.25.25.0 01-.354.0l-6.25-6.25A.25.25.0 012.5 7.775zm-1.5.0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464.0.91.184 1.238.513l6.25 6.25a1.75 1.75.0 010 2.474l-5.026 5.026a1.75 1.75.0 01-2.474.0l-6.25-6.25A1.75 1.75.0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"/></svg><span class=m-1>Tags</span>
<span class="badge fw-normal bg-secondary bg-opacity-25 text-opacity-50 rounded-pill text-dark-emphasis">48</span></a></li></ul><div class="d-flex flex-column border rounded mt-4 mt-md-0"><div class="border-bottom bg-light markdown-sticky-top"><div class="d-flex flex-row align-items-center"><div class=btn-group role=group><button type=button class=btn data-bs-toggle=dropdown aria-expanded=false><svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16"><path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zm0 5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zm0 5a.75.75.0 000 1.5h8.5a.75.75.0 000-1.5h-8.5zM3 8A1 1 0 111 8a1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"/></svg></button><ul class=dropdown-menu id=toc-list><li><h6 class=dropdown-header>Table of Content</h6></li></ul></div><div class="flex-fill text-secondary fs-7"><relative-time datetime="Sat, 07 Feb 2026 00:00:00 +0100"></relative-time></div><div class="pe-2 d-none d-md-block"><a class="badge text-bg-secondary text-dark fw-normal bg-opacity-25 pb-1 link-underline link-underline-opacity-0 link-underline-opacity-100-hover" href=/tags/passthrough>passthrough</a>
<a class="badge text-bg-secondary text-dark fw-normal bg-opacity-25 pb-1 link-underline link-underline-opacity-0 link-underline-opacity-100-hover" href=/tags/gpu>gpu</a>
<a class="badge text-bg-secondary text-dark fw-normal bg-opacity-25 pb-1 link-underline link-underline-opacity-0 link-underline-opacity-100-hover" href=/tags/game>game</a>
<a class="badge text-bg-secondary text-dark fw-normal bg-opacity-25 pb-1 link-underline link-underline-opacity-0 link-underline-opacity-100-hover" href=/tags/vm>vm</a>
<a class="badge text-bg-secondary text-dark fw-normal bg-opacity-25 pb-1 link-underline link-underline-opacity-0 link-underline-opacity-100-hover" href=/tags/qemu>qemu</a></div></div></div><div class="pt-4 px-2 pb-3"><article class="markdown-body container-lg"><p><em>This article was generated by AI based on the <a href=https://github.com/dmachard/homelab-gaming>homelab-gaming</a> project.</em></p><p>Mon besoin</p><ol><li><strong>Mode TV/Salon</strong> : la VM Windows affiche directement sur la TV via HDMI, manettes Xbox pour du gaming familial</li><li><strong>Mode Bureau</strong> : accès à la même VM via Looking Glass depuis le PC, clavier/souris pour des jeux solo ou du travail</li></ol><p>Le GPU passthrough combiné à Looking Glass permet de répondre à ce besoin: faire tourner une VM Windows avec accès direct au GPU, accessible soit sur une TV pour du gaming familial, soit depuis le bureau via <a href=https://looking-glass.io/>Looking Glass</a>, tout en conservant le PC Linux pleinement fonctionnel.</p><h2 id=les-technos-clés><a class=anchor href=#les-technos-clés>Les technos clés</a></h2><h3 id=gpu-passthrough><a class=anchor href=#gpu-passthrough>GPU Passthrough</a></h3><p>Le GPU passthrough, aussi appelé VFIO, est une technique de virtualisation permettant de donner à une machine virtuelle un accès direct et exclusif à une carte graphique physique. Contrairement à l&rsquo;émulation graphique classique qui passe par l&rsquo;hyperviseur et dégrade fortement les performances, le passthrough offre des performances quasi-natives.</p><p><strong>Principe de fonctionnement</strong> : le GPU est isolé du système hôte au démarrage via les groupes IOMMU du processeur. La carte graphique est alors &ldquo;détachée&rdquo; du noyau Linux et assignée directement à la VM. Du point de vue de Windows, c&rsquo;est comme si la carte était physiquement connectée à une machine dédiée.</p><p><strong>Prérequis matériels</strong> :</p><ul><li>Processeur avec support IOMMU (Intel VT-d ou AMD-Vi)</li><li>Carte mère compatible</li><li>De préférence deux GPU (un pour l&rsquo;hôte, un pour la VM) ou un iGPU + GPU dédié</li></ul><p>Dans ce guide, le GPU AMD RX 7800 XT est entièrement dédié à la VM Windows, tandis que l&rsquo;hôte Ubuntu utilise le GPU intégré du Ryzen 9 9900X.</p><h3 id=looking-glass><a class=anchor href=#looking-glass>Looking Glass</a></h3><p><strong>Looking Glass</strong> est un logiciel open source qui résout un problème majeur du GPU passthrough : comment accéder à l&rsquo;affichage de la VM sans avoir un second moniteur dédié ?</p><p><strong>Le problème</strong> : avec le passthrough classique, le GPU est physiquement connecté à un écran. Pour utiliser la VM, il faut soit switcher d&rsquo;écran, soit avoir deux moniteurs séparés.</p><p><strong>La solution Looking Glass</strong> : ce système capture l&rsquo;affichage du GPU dans la VM et le transmet au système hôte via une zone de mémoire partagée (shared memory). Un client léger sur Linux affiche alors le rendu dans une fenêtre, avec une latence extrêmement faible (typiquement &lt; 1ms).</p><p><strong>Architecture</strong> :</p><ul><li>Un binaire &ldquo;host&rdquo; tourne dans la VM Windows et capture les frames du GPU</li><li>Un binaire &ldquo;client&rdquo; tourne sur l&rsquo;hôte Linux et affiche le flux</li><li>Communication via <code>/dev/kvmfr0</code> (mémoire partagée)</li><li>Support des périphériques USB partagés (clavier/souris)</li></ul><p>L&rsquo;avantage majeur : basculer instantanément entre Linux et la VM Windows sans changer d&rsquo;écran ni de cable, tout en conservant des performances de jeu optimales.</p><h2 id=architecture-de-la-solution><a class=anchor href=#architecture-de-la-solution>Architecture de la solution</a></h2><h3 id=matériel><a class=anchor href=#matériel>Matériel</a></h3><p>La configuration repose sur du matériel compatible avec la virtualisation et le passthrough GPU :</p><ul><li><strong>Processeur</strong> : AMD Ryzen 9 9900X (support IOMMU)</li><li><strong>Carte graphique</strong> : AMD Radeon RX 7800 XT (passée à la VM)</li><li><strong>Affichage</strong> : double sortie HDMI vers TV et moniteur de bureau</li><li><strong>Périphériques</strong> : manettes Xbox sans fil</li></ul><h3 id=stack-logicielle><a class=anchor href=#stack-logicielle>Stack logicielle</a></h3><ul><li><strong>Système hôte</strong> : Ubuntu 25.10</li><li><strong>Hyperviseur</strong> : QEMU avec libvirt</li><li><strong>Système invité</strong> : Windows 10</li><li><strong>Accès distant</strong> : Looking Glass pour un affichage à faible latence</li></ul><h2 id=mise-en-place-côté-hôte-linux><a class=anchor href=#mise-en-place-côté-hôte-linux>Mise en place côté hôte Linux</a></h2><h3 id=isolation-du-matériel><a class=anchor href=#isolation-du-matériel>Isolation du matériel</a></h3><p>La première étape consiste à isoler la carte graphique du système hôte pour la réserver exclusivement à la VM.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd gpu_passthrough/
</span></span><span style=display:flex><span>sudo ./config.sh
</span></span></code></pre></div><p>Pour permettre à libvirt d&rsquo;accéder au device Looking Glass, éditer la configuration des groupes de contrôle en ajoutant <code>/dev/kvmfr0</code> dans la liste des périphériques autorisés :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/libvirt/qemu.conf
</span></span></code></pre></div><p>Chercher la section <code>cgroup_device_acl</code> et ajouter l&rsquo;entrée manquante :</p><pre tabindex=0><code>cgroup_device_acl = [
    &#34;/dev/null&#34;, &#34;/dev/full&#34;, &#34;/dev/zero&#34;,
    &#34;/dev/random&#34;, &#34;/dev/urandom&#34;,
    &#34;/dev/ptmx&#34;, &#34;/dev/kvm&#34;,
    &#34;/dev/userfaultfd&#34;,
    &#34;/dev/kvmfr0&#34;
]
</code></pre><p>Redémarrer le service :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart libvirtd
</span></span></code></pre></div><p>Après un redémarrage complet de la machine, vérifier que l&rsquo;isolation fonctionne :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd gpu_passthrough/
</span></span><span style=display:flex><span>sudo ./check.sh
</span></span></code></pre></div><h3 id=import-de-la-vm><a class=anchor href=#import-de-la-vm>Import de la VM</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd vm_qemu
</span></span><span style=display:flex><span>./import_vm.sh
</span></span></code></pre></div><h3 id=installation-du-client-looking-glass><a class=anchor href=#installation-du-client-looking-glass>Installation du client Looking Glass</a></h3><p>Looking Glass permet d&rsquo;accéder à l&rsquo;affichage de la VM avec une latence minimale.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd looking_glass
</span></span><span style=display:flex><span>./install.sh
</span></span></code></pre></div><p>Deux icônes sont disponibles dans le lanceur d&rsquo;applications selon l&rsquo;état de la connexion (vert pour connecté, rouge pour déconnecté).</p><h2 id=configuration-de-la-vm-windows><a class=anchor href=#configuration-de-la-vm-windows>Configuration de la VM Windows</a></h2><h3 id=monitoring-du-gpu><a class=anchor href=#monitoring-du-gpu>Monitoring du GPU</a></h3><p>Déployer un serveur API léger en Python dans la VM pour surveiller l&rsquo;état du GPU depuis l&rsquo;hôte. Les scripts <code>status_gpu.py</code> et <code>status_gpu.bat</code> situés dans <code>scripts_vm/</code> exposent ces informations sur le port 8081.</p><h3 id=installation-de-looking-glass-host><a class=anchor href=#installation-de-looking-glass-host>Installation de Looking Glass Host</a></h3><p>Côté Windows, télécharger et installer le binaire host de Looking Glass depuis <a href=https://looking-glass.io/artifact/stable/host>https://looking-glass.io/artifact/stable/host</a>. Ce composant capture l&rsquo;affichage et le transmet au client Linux via la mémoire partagée.</p><h3 id=amélioration-de-lexpérience><a class=anchor href=#amélioration-de-lexpérience>Amélioration de l&rsquo;expérience</a></h3><p><strong>AutoHotkey</strong> permet de créer des raccourcis personnalisés accessibles depuis les manettes Xbox. Les scripts <code>xinput.ahk</code> et <code>gamepad.ahk</code> du dossier <code>autohotkey/</code> doivent être configurés au démarrage de Windows pour quitter un émulateur sans toucher au clavier.</p><p><strong>SoundSwitch</strong> simplifie la bascule entre les sorties audio, notamment entre les enceintes du PC et le système audio de la TV via HDMI. Installation depuis <a href=https://soundswitch.aaflao.me/>https://soundswitch.aaflao.me/</a></p><p><strong>OpenRGB</strong> désactive les LEDs de la carte graphique. Installation depuis <a href=https://openrgb.org/>https://openrgb.org/</a></p><h3 id=émulation-console><a class=anchor href=#émulation-console>Émulation console</a></h3><p>Ryujinx offre d&rsquo;excellentes performances pour l&rsquo;émulation Nintendo Switch dans cet environnement grâce à l&rsquo;accès direct au GPU. Installation depuis <a href=https://ryujinx.app/>https://ryujinx.app/</a></p><h3 id=sécurisation-réseau><a class=anchor href=#sécurisation-réseau>Sécurisation réseau</a></h3><p>Activer le pare-feu Windows et bloquer tout le trafic par défaut. Créer une exception uniquement pour le port TCP 8081 en entrée, nécessaire à l&rsquo;API de monitoring.</p><h2 id=résultat><a class=anchor href=#résultat>Résultat</a></h2><p>Cette architecture offre une flexibilité remarquable : gaming sur TV avec manettes pour des sessions familiales, ou utilisation depuis le bureau via Looking Glass pour des jeux nécessitant clavier et souris, sans jamais perdre l&rsquo;accès à l&rsquo;environnement Linux natif.</p><p>Les performances sont au rendez-vous grâce au passthrough GPU qui élimine la couche d&rsquo;émulation graphique. Looking Glass délivre une latence imperceptible pour un usage bureautique ou gaming.</p><h2 id=ressources><a class=anchor href=#ressources>Ressources</a></h2><ul><li><a href=https://github.com/votre-username/homelab-gaming>Dépôt GitHub du projet</a></li><li><a href=https://looking-glass.io/>Documentation Looking Glass</a></li><li><a href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF>Guide VFIO Arch Linux</a></li></ul></article></div></div></div></div></div></main><div class=container-xl><div class="pt-6 text-secondary border-top"><span>propulsed by
<a class="link-primary link-underline link-underline-opacity-0 link-underline-opacity-100-hover link-offset-2-hover" href=https://gohugo.io/>hugo</a>
and
<a class="link-primary link-underline link-underline-opacity-0 link-underline-opacity-100-hover link-offset-2-hover" href=https://github.com/dmachard/hugo-theme-gists>hugo-theme-gists</a></span></div></div></body><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js integrity=sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL crossorigin=anonymous></script>
<script type=application/javascript src=https://dmachard.github.io/js/gists.js></script></html>